<html>
    <head>
        <script>document.write('<script src="gamifyd_sso.min.0.0.10.js?dev=' + Math.floor(Math.random() * 100) + '"\><\/script>');</script>
    </head>
    <body>
        <script>GamifyDigital.trackCb();</script>
        <button id="connect_bt">Sign In</button>
        <div id="profile" style="display:none;">
            <button id="disconnect_bt">Sign Out</button> -
            <button id="my_identity">My identity</button>
        </div>
        <br/>
        <div id="output">

        </div>
        <script>
        function echo() {
            var output = '';
            for(var i = 0; i < arguments.length; i++) {
                output += JSON.stringify(arguments[i], null, "\t") + "\n";
            }
            findMe('output').innerHTML = '<pre>'+output+'</pre>';
        }
        function findMe(id) {
            return document.getElementById(id);
        }

        function signed(identity) {
            echo(identity, GamifyDigital.getAccessHash());
            // console.log(jwt_decode(GamifyDigital.getAccessToken()));
            findMe('connect_bt').style.display = 'none';
            findMe('profile').style.display = 'block';
        }
        function unsigned() {
            findMe('profile').style.display = 'none';
            findMe('connect_bt').style.display = 'block';
            echo("You're logged out");
        }
        findMe('connect_bt').addEventListener('click', function() {
            GamifyDigital.signIn({
                // width: 475,
                // height: 500,
                success: signed,
                error: function() {
                    echo("SIGNIN ERROR", arguments);
                }
            });
        });
        findMe('disconnect_bt').addEventListener('click', function() {
            GamifyDigital.signOut({
                success: unsigned,
                error: function() {
                    echo("SIGNOUT ERROR", arguments);
                }
            });
        });
        findMe('my_identity').addEventListener('click', function() {
            GamifyDigital.identity({
                success: function(data) {
                    echo("My Identity", arguments);
                }
            });
        });
        GamifyDigital.init({
            // Required parameters
            client_id: 'openid-dow',
            redirect_uri: 'http://localhost:8080/cbpop.html',

            // Example of optional parameters
            base_is_host: 'https://account.gamify-digital.com', //https://account.staging.gamify-digital.com',
            scope: 'openid+email+address+public',
            response_type: 'code id_token token'
        }).discover();
        </script>
    </body>
</html>
